---
phase: 02-shell-reliability-hardening
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - zsh/.zshrc
autonomous: true
requirements:
  - SHLL-01
  - SHLL-02
user_setup: []
must_haves:
  truths:
    - OPSEC history settings and startup behavior remain intact across reloads.
    - Warp and non-Warp shells expose predictable runtime behavior without prompt regressions.
    - Environment path ordering for Homebrew, Python 3.13, OpenJDK 17, and pdtm/Go remains stable.
  artifacts:
    - zsh/.zshrc
  key_links:
    - zsh/.zshrc:history settings -> interactive shell behavior
    - zsh/.zshrc:Warp detection branch -> prompt/runtime path selection
    - zsh/.zshrc:PATH export ordering -> tool resolution precedence
---

<objective>
Stabilize shell options, prompt branching, and environment ordering in `zsh/.zshrc`.

Purpose: Preserve locked reliability contracts while making startup behavior explicit and deterministic.
Output: Hardened shell startup/runtime branches for Warp and non-Warp terminals.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-shell-reliability-hardening/02-CONTEXT.md
@.planning/phases/02-shell-reliability-hardening/02-RESEARCH.md
@zsh/.zshrc
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add explicit Warp/runtime branching while preserving OPSEC shell invariants</name>
  <files>zsh/.zshrc</files>
  <action>Introduce explicit runtime branching for Warp detection (`TERM_PROGRAM=WarpTerminal` -> `WARP_TERMINAL=1`) and keep non-Warp behavior deterministic. Preserve existing OPSEC history controls and startup guidance messaging, including `/help` discoverability.</action>
  <verify>zsh -n zsh/.zshrc</verify>
  <done>`zsh/.zshrc` contains explicit Warp detection state and OPSEC history settings remain present and unchanged in behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Normalize environment path ordering and guard optional startup loaders</name>
  <files>zsh/.zshrc</files>
  <action>Consolidate environment/path ordering so Homebrew, Python 3.13, OpenJDK 17, pdtm/Go, and local bin precedence remain explicit. Ensure optional loaders/plugins remain existence-checked and non-fatal during startup.</action>
  <verify>rg -n "python@3.13|openjdk@17|\.pdtm/go/bin|hist_ignore_space|WARP_TERMINAL" zsh/.zshrc</verify>
  <done>Path/export order is explicit and optional loaders are guarded, with no startup-critical command relying on unchecked file presence.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `zsh -n zsh/.zshrc` passes
- [ ] `TERM_PROGRAM=WarpTerminal ZDOTDIR=/opt/dotfiles/zsh zsh -i -c 'print -r -- "${WARP_TERMINAL:-0}"'` outputs `1`
- [ ] `TERM_PROGRAM=Apple_Terminal ZDOTDIR=/opt/dotfiles/zsh zsh -i -c 'print -r -- "${WARP_TERMINAL:-0}"'` outputs `0`
</verification>

<success_criteria>

- OPSEC and startup contracts are preserved
- Warp/non-Warp runtime behavior is explicit and stable
- Environment ordering remains consistent with project constraints

</success_criteria>

<output>
After completion, create `.planning/phases/02-shell-reliability-hardening/02-01-SUMMARY.md`
</output>
