---
phase: 03-tmux-vim-workflow-stability
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - vim/.vimrc
autonomous: true
requirements:
  - TVIM-02
user_setup: []
must_haves:
  truths:
    - Vim starts cleanly even when optional plugin/theme dependencies are missing.
    - Theme fallback priority remains `catppuccin -> dracula -> molokai`.
    - Existing key mappings remain available without introducing new feature families.
  artifacts:
    - vim/.vimrc
  key_links:
    - vim/.vimrc:plugin bootstrap block -> graceful startup without plugin manager
    - vim/.vimrc:colorscheme fallback chain -> catppuccin, dracula, molokai ordering
    - vim/.vimrc:COC usage guards -> avoid runtime breakage when plugin missing
---

<objective>
Validate and harden Vim startup, plugin bootstrap, and fallback behavior in `vim/.vimrc`.

Purpose: Prevent startup breakage while preserving existing editor workflow contracts.
Output: Vim config that degrades gracefully under missing plugin dependencies.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-tmux-vim-workflow-stability/03-CONTEXT.md
@.planning/phases/03-tmux-vim-workflow-stability/03-RESEARCH.md
@vim/.vimrc
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Guard plugin bootstrap and plugin-dependent calls</name>
  <files>vim/.vimrc</files>
  <action>Add startup guards so missing `vim-plug` or plugin-provided functions do not break Vim startup. Keep existing mappings and behavior contracts, but ensure plugin-dependent actions fail soft with clear fallback behavior.</action>
  <verify>rg -n "plug#begin|plug#end|exists\\('\\*plug#begin'\\)|CocAction|CocActionAsync|coc#refresh" vim/.vimrc</verify>
  <done>Vim startup path is guarded against missing plugin manager and plugin functions are conditionally used.</done>
</task>

<task type="auto">
  <name>Task 2: Preserve fallback theme chain and run startup smoke checks</name>
  <files>vim/.vimrc</files>
  <action>Preserve the existing fallback theme ordering (`catppuccin_mocha`, then `dracula`, then `molokai`) and ensure headless startup succeeds in both normal and minimal-home conditions.</action>
  <verify>rg -n "colorscheme catppuccin_mocha|colorscheme dracula|colorscheme molokai" vim/.vimrc</verify>
  <done>Theme chain ordering remains intact and startup smoke checks pass without plugin dependency hard-failures.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `vim -Nu /opt/dotfiles/vim/.vimrc -n -es -c 'qa!'` exits 0
- [ ] `TMP_HOME=$(mktemp -d) && HOME="$TMP_HOME" vim -Nu /opt/dotfiles/vim/.vimrc -n -es -c 'qa!'` exits 0
- [ ] `rg -n "colorscheme catppuccin_mocha|colorscheme dracula|colorscheme molokai" vim/.vimrc` confirms fallback ordering
</verification>

<success_criteria>

- Vim startup is resilient to missing optional dependencies
- Theme fallback chain remains locked and unchanged in order
- Existing mapping surface remains stable for operator workflows

</success_criteria>

<output>
After completion, create `.planning/phases/03-tmux-vim-workflow-stability/03-02-SUMMARY.md`
</output>
