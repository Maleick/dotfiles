---
phase: 07-verification-wrapper-modes-and-output-contracts
plan: 02
type: execute
wave: 2
depends_on:
  - "07-01"
files_modified:
  - scripts/verify-suite.sh
  - README.md
  - AGENTS.md
autonomous: true
requirements:
  - AUTO-05
user_setup: []
must_haves:
  truths:
    - Wrapper supports deterministic machine-readable output via `--json`.
    - Wrapper supports combined mode `--quick --json` with quick selection semantics.
    - Required-failure exit semantics remain non-zero across text and json modes.
    - README and AGENTS document mode flags and compatibility-preservation expectations.
  artifacts:
    - scripts/verify-suite.sh
    - README.md
    - AGENTS.md
  key_links:
    - scripts/verify-suite.sh:json reporter -> per-check records + deterministic summary counts
    - scripts/verify-suite.sh:combined mode path -> `--quick --json` support
    - README.md:wrapper usage -> default/quick/json/combined mode semantics
    - AGENTS.md:maintainer contract -> deterministic mode behavior and backward compatibility
---

<objective>
Implement machine-readable and combined-mode contracts, then align operator/maintainer documentation.

Purpose: satisfy `AUTO-05` while preserving existing wrapper reliability guarantees.
Output: deterministic JSON output in `scripts/verify-suite.sh` plus synced docs in `README.md` and `AGENTS.md`.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/07-verification-wrapper-modes-and-output-contracts/07-CONTEXT.md
@.planning/phases/07-verification-wrapper-modes-and-output-contracts/07-RESEARCH.md
@scripts/verify-suite.sh
@README.md
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deterministic `--json` output and combined `--quick --json` support</name>
  <files>scripts/verify-suite.sh</files>
  <action>Implement JSON output mode that emits deterministic per-check records and summary counts (`PASS`/`FAIL`/`SKIP`). Ensure combined mode `--quick --json` works and retains quick check selection plus required-failure exit semantics.</action>
  <verify>./scripts/verify-suite.sh --json >/tmp/verify-suite-json.out 2>&1 && python3 -m json.tool /tmp/verify-suite-json.out >/dev/null && rg -n '"checks"|"summary"|"mode"|"PASS"|"FAIL"|"SKIP"' /tmp/verify-suite-json.out && ./scripts/verify-suite.sh --quick --json >/tmp/verify-suite-quick-json.out 2>&1 && python3 -m json.tool /tmp/verify-suite-quick-json.out >/dev/null && rg -n '"mode"\s*:\s*"quick"|"checks"|"summary"' /tmp/verify-suite-quick-json.out</verify>
  <done>JSON and combined modes produce deterministic, parseable payloads with correct mode semantics.</done>
</task>

<task type="auto">
  <name>Task 2: Preserve failure semantics and document mode contracts</name>
  <files>scripts/verify-suite.sh,README.md,AGENTS.md</files>
  <action>Validate and preserve non-zero required-failure behavior in json and combined modes. Update README and AGENTS with mode flags (`default`, `--quick`, `--json`, `--quick --json`), deterministic output semantics, and backward-compatibility expectations.</action>
  <verify>VERIFY_SUITE_FORCE_FAIL_REQUIRED=1 ./scripts/verify-suite.sh --json >/tmp/verify-suite-json-fail.out 2>&1; test $? -ne 0 && VERIFY_SUITE_FORCE_FAIL_REQUIRED=1 ./scripts/verify-suite.sh --quick --json >/tmp/verify-suite-quick-json-fail.out 2>&1; test $? -ne 0 && rg -n "--quick|--json|verify-suite|deterministic|PASS|FAIL|SKIP" README.md AGENTS.md && ! rg -n "COMP-03|compatibility matrix row generation|CI-provider" README.md AGENTS.md</verify>
  <done>Failure semantics are preserved in all modes and docs accurately describe mode contracts without scope creep.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `./scripts/verify-suite.sh --json` emits parseable JSON with deterministic check/summary fields
- [ ] `./scripts/verify-suite.sh --quick --json` emits parseable JSON and quick-mode semantics
- [ ] forced required failure is non-zero in json and combined modes
- [ ] README and AGENTS include mode contract documentation and preserve backward compatibility guidance
- [ ] no `COMP-03` implementation scope appears in this plan
</verification>

<success_criteria>

- `AUTO-05` is satisfied with deterministic machine-readable reporting
- Combined mode contract works and remains compatible with quick-mode behavior
- Documentation clearly communicates mode usage and contract guarantees

</success_criteria>

<output>
After completion, create `.planning/phases/07-verification-wrapper-modes-and-output-contracts/07-02-SUMMARY.md`
</output>
