---
phase: 01-installation-baseline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - install.sh
autonomous: true
requirements:
  - INST-01
  - INST-02
  - INST-03
user_setup: []
must_haves:
  truths:
    - Running install repeatedly preserves valid symlink targets for managed dotfiles.
    - Existing user dotfiles are backed up before replacement scenarios.
    - Installer logs clearly indicate whether links were created, updated, or already correct.
  artifacts:
    - install.sh
  key_links:
    - install.sh:link_file -> ~/.zshrc symlink behavior
    - install.sh:link_file -> ~/.tmux.conf symlink behavior
    - install.sh:link_file -> ~/.vimrc symlink behavior
---

<objective>
Harden installer idempotency and backup behavior in `install.sh`.

Purpose: Ensure Phase 1 baseline safety requirements are met with deterministic behavior.
Output: Updated installer logic and logs for safe re-runs.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-installation-baseline/01-CONTEXT.md
@.planning/phases/01-installation-baseline/01-RESEARCH.md
@install.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Harden link target checks in installer</name>
  <files>install.sh</files>
  <action>Update `link_file()` to detect already-correct symlinks and skip destructive operations. Preserve backup behavior for existing non-symlink files and mis-targeted symlinks by moving them into the timestamped backup directory before creating the new symlink.</action>
  <verify>bash -n install.sh</verify>
  <done>`install.sh` syntax passes and `link_file()` contains explicit branches for already-correct symlink, backup path, and create/update path.</done>
</task>

<task type="auto">
  <name>Task 2: Add deterministic installer logging for reruns</name>
  <files>install.sh</files>
  <action>Standardize installer output to explicitly report each target state (`already linked`, `backed up`, `linked`) so operators can verify idempotency outcomes from logs.</action>
  <verify>./install.sh || true</verify>
  <done>Installer output emits clear per-target status messages without ambiguous silent transitions.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `bash -n install.sh` passes
- [ ] Running `./install.sh` twice does not fail
- [ ] `ls -l ~/.zshrc ~/.tmux.conf ~/.vimrc` points to repo targets after rerun
</verification>

<success_criteria>

- Installer remains safe to re-run
- Backup path behavior preserved for replacement scenarios
- Logs are explicit enough to audit idempotency outcomes

</success_criteria>

<output>
After completion, create `.planning/phases/01-installation-baseline/01-01-SUMMARY.md`
</output>
